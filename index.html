<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Advanced loan calculator with floating rates, prepayments, and dynamic adjustments">
    <title>Smart Loan Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        :root {
            --primary: #24774c;
            --secondary: #ff9f43;
            --background: #ffffff;
            --text: #2d3436;
            --surface: #f8f9fa;
            --border: #dfe6e9;
            --dark-background: #1a1a1a;
            --dark-surface: #2d2d2d;
            --dark-text: #ffffff;
            --dark-border: #404040;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        [data-theme="dark"] {
            --background: var(--dark-background);
            --text: var(--dark-text);
            --surface: var(--dark-surface);
            --border: var(--dark-border);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background: var(--background);
            color: var(--text);
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            line-height: 1.6;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding: 1.5rem;
            border-radius: 18px;
            background: var(--surface);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .calculator-card {
            background: var(--surface);
            border-radius: 18px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1rem;
            align-items: center;
        }

        input,
        select,
        button {
            padding: 0.8rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            background: var(--surface);
            color: var(--text);
        }

        input[type="range"] {
            padding: 0;
            height: 6px;
        }

        button {
            background: var(--primary);
            color: white;
            cursor: pointer;
            border: none;
        }

        #loanChart {
            margin: 2rem 0;
            max-height: 400px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
            border-radius: 12px;
            margin: 2rem 0;
        }

        th,
        td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--primary);
            color: white;
        }

        footer {
            text-align: center;
            margin-top: 2rem;
            padding: 2rem;
        }
    </style>
</head>

<body>
    <header>
        <h1><i class="fas fa-calculator"></i> Loan Calculator</h1>
        <div class="theme-toggle">
            <i class="fas fa-sun"></i>
            <label class="switch">
                <input type="checkbox" id="themeSwitch">
                <span class="slider"></span>
            </label>
            <i class="fas fa-moon"></i>
        </div>
    </header>

    <div class="calculator-card">
        <div class="input-group">
            <label>Loan Amount</label>
            <div class="slider-container">
                <input type="range" id="amountSlider" min="100000" max="10000000" value="1000000">
                <input type="number" id="amount" value="1000000">
            </div>
        </div>

        <div class="input-group">
            <label>Interest Rate (%)</label>
            <div class="slider-container">
                <input type="range" id="rateSlider" min="1" max="20" step="0.1" value="8.5">
                <input type="number" id="rate" value="8.5" step="0.1">
            </div>
        </div>

        <div class="input-group">
            <label>Start Date</label>
            <input type="text" id="startDate" class="flatpickr-input">
        </div>

        <div class="input-group">
            <label>Tenure (months)</label>
            <input type="number" id="tenure" value="12">
        </div>

        <canvas id="loanChart"></canvas>

        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>EMI</th>
                    <th>Principal</th>
                    <th>Interest</th>
                    <th>Balance</th>
                </tr>
            </thead>
            <tbody id="schedule"></tbody>
        </table>
    </div>

    <footer>
        <p>Made with ❤️ by Tokudai <a href="https://github.com/tokudai-vs" target="_blank"><i
                    class="fab fa-github"></i></a></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        const DateTime = luxon.DateTime;
        let loanChart = null;

        // Theme Toggle
        document.getElementById('themeSwitch').addEventListener('change', toggleTheme);

        function toggleTheme() {
            document.body.setAttribute('data-theme',
                document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'
            );
            updateChartColors();
        }

        // Date Picker
        flatpickr("#startDate", {
            dateFormat: "Y-m-d",
            defaultDate: new Date()
        });

        // Input Synchronization
        function syncInputs(source, target) {
            document.getElementById(source).addEventListener('input', function () {
                document.getElementById(target).value = this.value;
                calculate();
            });
        }

        syncInputs('amountSlider', 'amount');
        syncInputs('amount', 'amountSlider');
        syncInputs('rateSlider', 'rate');
        syncInputs('rate', 'rateSlider');
        document.getElementById('tenure').addEventListener('input', calculate);

        // Core Calculation
        function calculate() {
            const amount = parseFloat(document.getElementById('amount').value);
            const rate = parseFloat(document.getElementById('rate').value) / 100;
            const tenure = parseInt(document.getElementById('tenure').value);
            const startDate = DateTime.fromISO(document.getElementById('startDate').value);

            const monthlyRate = rate / 12;
            const emi = (amount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -tenure));
            let balance = amount;
            const schedule = [];

            for (let month = 1; month <= tenure; month++) {
                const interest = balance * monthlyRate;
                const principal = emi - interest;
                balance -= principal;

                schedule.push({
                    date: startDate.plus({ months: month - 1 }).toFormat('dd MMM yyyy'),
                    emi,
                    principal,
                    interest,
                    balance: Math.max(balance, 0)
                });
            }

            updateChart(schedule);
            updateSchedule(schedule);
        }

        function updateChart(schedule) {
            const ctx = document.getElementById('loanChart').getContext('2d');
            const principal = schedule.reduce((sum, item) => sum + item.principal, 0);
            const interest = schedule.reduce((sum, item) => sum + item.interest, 0);

            if (loanChart) loanChart.destroy();

            loanChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Principal', 'Interest'],
                    datasets: [{
                        data: [principal, interest],
                        backgroundColor: ['#24774c', '#ff9f43'],
                        borderWidth: 0
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text')
                            }
                        }
                    }
                }
            });
        }

        function updateChartColors() {
            if (loanChart) {
                loanChart.options.plugins.legend.labels.color =
                    getComputedStyle(document.body).getPropertyValue('--text');
                loanChart.update();
            }
        }

        function updateSchedule(schedule) {
            const formatter = new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0
            });

            document.getElementById('schedule').innerHTML = schedule.map(item => `
                <tr>
                    <td>${item.date}</td>
                    <td>${formatter.format(item.emi)}</td>
                    <td>${formatter.format(item.principal)}</td>
                    <td>${formatter.format(item.interest)}</td>
                    <td>${formatter.format(item.balance)}</td>
                </tr>
            `).join('');
        }

        // Initial calculation
        calculate();
    </script>
</body>

</html>